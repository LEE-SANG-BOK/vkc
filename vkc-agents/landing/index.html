<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VietKConnect â€” ì˜¤ëŠ˜ì˜ ì‹¤í–‰ ì¹´ë“œ Top5</title>

    <!-- Open Graph / Twitter (share preview) -->
    <meta property="og:title" content="ì˜¤ëŠ˜ì˜ ì‹¤í–‰ ì¹´ë“œ Top5" />
    <meta property="og:description" content="ë¹„ìÂ·ê·¼ë¬´Â·ì‹œí—˜Â·ìƒí™œ â€” ì§€ê¸ˆ ê²°ì •ì— í•„ìš”í•œ ë‹µ" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/og-image-1200x630.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ì˜¤ëŠ˜ì˜ ì‹¤í–‰ ì¹´ë“œ Top5" />
    <meta name="twitter:description" content="ë¹„ìÂ·ê·¼ë¬´Â·ì‹œí—˜Â·ìƒí™œ â€” ì§€ê¸ˆ ê²°ì •ì— í•„ìš”í•œ ë‹µ" />
    <meta name="twitter:image" content="/og-image-1200x630.png" />
    <!-- Optional: external leaderboard JSON/CSV URL (set content) -->
    <meta name="leaderboard-url" content="/leaderboard.json" />

    <!-- GA4 (TODO: G-XXXXXXXXë¥¼ ì‹¤ì œ Measurement IDë¡œ êµì²´í•˜ê±°ë‚˜, ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ì œê±°) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PZDWM0LECS"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-PZDWM0LECS');
      window.addEventListener('page_view', (e) => { const p = e.detail || {}; gtag('event', 'page_view_custom', p); });
      window.addEventListener('scroll_75', (e) => { const p = e.detail || {}; gtag('event', 'scroll_75', p); });
      window.addEventListener('cta_click', (e) => { const p = e.detail || {}; gtag('event', 'cta_click', p); });
      window.addEventListener('sign_up', (e) => { const p = e.detail || {}; gtag('event', 'sign_up', p); });
    </script>

    <!-- Meta Pixel (ì„ íƒ, TODO: PIXEL_ID êµì²´) -->
    <script>
      !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
      n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
      document,'script','https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', 'PIXEL_ID'); fbq('track', 'PageView');
      window.addEventListener('cta_click', (e) => { fbq('track', 'Lead', e.detail || {}); });
    </script>
    <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=PIXEL_ID&ev=PageView&noscript=1"/></noscript>

    <style>
      :root { color-scheme: light dark; }
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, sans-serif; }
      .hero { max-width: 980px; margin: 0 auto; padding: 56px 24px; }
      .badge { display: inline-flex; align-items: center; gap: 8px; background: #eef6ff; color: #0a66ff; padding: 6px 10px; border-radius: 999px; font-size: 12px; font-weight: 700; }
      .h1 { font-size: 40px; font-weight: 800; line-height: 1.15; margin: 12px 0 0; }
      .h2 { font-size: 18px; color: #444; margin: 12px 0 12px; }
      .cta { margin-top: 16px; padding: 12px 20px; background: #0a66ff; color: #fff; border-radius: 10px; border: 0; font-weight: 700; cursor: pointer; }
      .trust { margin-top: 14px; font-size: 14px; color: #222 }
      .disclaimer { margin-top: 8px; font-size: 12px; color: #666; }
      .section { max-width: 980px; margin: 0 auto; padding: 0 24px 32px; color: #222; }
      .section h3 { margin: 24px 0 8px; }
      .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; }
      .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; background: #fff; }
      .sticky-cta { position: fixed; right: 16px; bottom: 16px; z-index: 30; box-shadow: 0 8px 24px rgba(0,0,0,.14); }
      .badge-k { display:inline-block; padding:2px 8px; border-radius:8px; background:#eef6ff; color:#0a66ff; font-size:12px; font-weight:700; }
      .ref-box { max-width:980px; margin: 0 auto 24px; padding: 0 24px; }
      .ref { border:1px dashed #cbd5e1; background:#f8fafc; padding:12px; border-radius:12px; display:flex; gap:8px; align-items:center; }
      .ref input { flex:1; padding:8px; border:1px solid #e5e7eb; border-radius:8px; }
      .banner { max-width:980px; margin: 0 auto; padding: 8px 24px; }
      .banner .inner { background:#0a66ff; color:#fff; padding:10px 14px; border-radius:12px; display:flex; justify-content:space-between; align-items:center; gap:12px; }
      .banner a { color:#fff; text-decoration: underline; }
      table.lb { width:100%; border-collapse: collapse; }
      table.lb th, table.lb td { border-bottom:1px solid #e5e7eb; padding:8px; text-align:left; }
      .muted { color:#64748b; font-size:12px; }
      .form-section { max-width: 980px; margin: 0 auto; padding: 0 24px 48px; }
      form { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; background: #fff; }
      label { display: block; font-weight: 600; margin-top: 12px; }
      input[type="text"], input[type="email"], select, textarea { width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 8px; margin-top: 6px; }
      .row { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
      .small { font-size: 12px; color: #666; }
    </style>
  </head>
  <body>

    <!-- Referral Event Banner -->
    <div class="banner">
      <div class="inner">
        <div>ë¦¬í¼ëŸ´ ë­í‚¹ ì´ë²¤íŠ¸ ì§„í–‰ ì˜ˆì • (Day5â€“Day18)</div>
        <div><a href="#pre_survey">ì§€ê¸ˆ ì°¸ì—¬</a> Â· <a href="#rules">ì´ë²¤íŠ¸ ì•ˆë‚´</a></div>
      </div>
    </div>

    <!-- Hero + A/B (variant) + UTM ì „íŒŒ + ì´ë²¤íŠ¸ ë°”ì¸ë”© -->
    <section class="hero" id="hero" data-variant="h1_a">
      <h1 class="h1" data-h1-a>24ì‹œê°„ ì•ˆì—, ë”± í•„ìš”í•œ ë‹µë§Œ ë°›ì</h1>
      <h1 class="h1" data-h1-b style="display:none">ê°‘ìê¸°ì¸ë° ì§ˆë¬¸í•´ë„ ë¼? ğŸ˜</h1>

      <p class="h2" data-sub-a>ë¹„ìÂ·ê·¼ë¬´Â·ì‹œí—˜Â·ìƒí™œ â€” ì˜¤ëŠ˜ì˜ ì‹¤í–‰ ì¹´ë“œ Top5</p>
      <p class="h2" data-sub-b style="display:none">ë¹„ìÂ·ê·¼ë¬´Â·ì‹œí—˜Â·ìƒí™œ â€” ì˜¤ëŠ˜ì˜ ì‹¤í–‰ ì¹´ë“œ Top5</p>

      <!-- Netlify Forms ì‚¬ìš©: CTAëŠ” í˜ì´ì§€ ë‚´ ì„¤ë¬¸ ì„¹ì…˜ìœ¼ë¡œ ì´ë™ -->
      <button class="cta" id="cta_primary" data-cta-a data-target-a="#pre_survey">ì§€ê¸ˆ ë‚´ ì‹¤í–‰ ì¹´ë“œ ë³´ê¸°</button>
      <button class="cta" id="cta_primary_b" data-cta-b data-target-b="#pre_survey" style="display:none">ì§€ê¸ˆ ë‚´ ì‹¤í–‰ ì¹´ë“œ ë³´ê¸°</button>
    </section>

    <!-- í˜œíƒ/í•µì‹¬ ì§ˆë¬¸ ì„¹ì…˜ â€” í˜œíƒ ì¤‘ì‹¬ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ êµ¬ì„± -->
    <section class="section" id="top5">
      <h3>ì˜¤ëŠ˜ì˜ ì‹¤í–‰ ì¹´ë“œ Top5</h3>
      <div class="grid">
        <div class="card"><span class="badge-k">ë¹„ì</span> Dâ€‘10â†’Eâ€‘7 12ì£¼ íë¦„</div>
        <div class="card"><span class="badge-k">ê·¼ë¬´</span> í‰ì¼ 25hÂ·ì™¸í™œí—ˆê°€ ì²´í¬</div>
        <div class="card"><span class="badge-k">ì‹œí—˜</span> TOPIK ì í”„ ë£¨í‹´</div>
        <div class="card"><span class="badge-k">ìƒí™œ</span> ê³„ì•½Â·ë³´ì¦ê¸ˆ ë¦¬ìŠ¤í¬ 2</div>
        <div class="card"><span class="badge-k">ì§€ì—­</span> ë¶€ì‚°Â·ê²½ë‚¨ ë§¤ì¹­Â·Fâ€‘2â€‘R í•œëˆˆì—</div>
      </div>
    </section>

    <section class="section" id="compare">
      <h3>ì™œ ì—¬ê¸°ì¸ê°€ (Compared to FB)</h3>
      <div class="grid">
        <div class="card">ì£¼ì œë³„ ì¹´ë“œë¡œ ë°”ë¡œ ì‹¤í–‰(ìŠ¤í¬ë¡¤Â·ë°˜ë³µì§ˆë¬¸ ìµœì†Œí™”)</div>
        <div class="card">ì¤‘ë³µÂ·ë£¨ë¨¸ ìµœì†Œí™”(ìë£ŒÂ·ì‚¬ë¡€ ì¤‘ì‹¬ ì •ë¦¬)</div>
        <div class="card">KR/VI ìš”ì•½ìœ¼ë¡œ ì €ì¥Â·ê³µìœ  ì‰¬ì›€</div>
        <div class="card">ì¸ì¦ëœ ì „ë¬¸ê°€/ì‹œë‹ˆì–´ì˜ ìµœì‹  íŒ(ì¶œì…êµ­ ì—…ë°ì´íŠ¸ ë°˜ì˜)</div>
      </div>
    </section>

    <!-- ì‹ ë¢° í¬ì¸íŠ¸: ì „ë¬¸ê°€/ì‹œë‹ˆì–´ íŒ -->
    <section class="section" id="expert_tips">
      <h3>ì‹ ë¢° í¬ì¸íŠ¸</h3>
      <div class="grid">
        <div class="card">ìµœê·¼ ì¶œì…êµ­ ë³€í™” ìš”ì•½ Â· ì²´í¬ 3</div>
        <div class="card">ì „ë¬¸ê°€/ì‹œë‹ˆì–´ ê¸°ì—¬ Â· ì‚¬ë¡€ ê¸°ë°˜ íŒ</div>
        <div class="card">ìë£Œ/ì¦ë¹™ ë§í¬ ë™ë°˜ Â· ì—…ë°ì´íŠ¸ ê³ ì§€</div>
      </div>
    </section>

    <!-- ì´ˆëŒ€ ë§í¬ ë³µì‚¬ ë°•ìŠ¤ (ë¦¬í¼ëŸ´) -->
    <div class="ref-box">
      <div class="ref">
        <span style="font-weight:700;color:#0a66ff">ë‚´ ì´ˆëŒ€ë§í¬</span>
        <input id="ref_link" readonly value="" />
        <button class="cta" id="ref_copy">ë³µì‚¬</button>
      </div>
      <p class="small">* ì´ˆëŒ€ ë§í¬ë¡œ ë“¤ì–´ì˜¨ ì‚¬ìš©ìì˜ â€˜ì„¤ê³„ ì œì¶œ + ìµœì†Œ 1í–‰ë™â€™ì´ ìœ íš¨ ì´ˆëŒ€ë¡œ ì¸ì •ë©ë‹ˆë‹¤.</p>
    </div>

    <!-- Netlify Forms: ì‚¬ì „ ì„¤ë¬¸(12ë¬¸í•­) -->
    <section class="form-section" id="pre_survey">
      <h3>ë‚´ ì‹¤í–‰ ì¹´ë“œ ì„¤ê³„ â€” ì•½ 1ë¶„</h3>
      <form name="pre_survey" method="POST" data-netlify="true" netlify-honeypot="bot-field" id="form-pre">
        <input type="hidden" name="form-name" value="pre_survey" />
        <p class="small">* í•„ìˆ˜ í•­ëª©. KR/VI ë³‘ê¸°.</p>
        <p style="display:none">
          <label>Donâ€™t fill this out: <input name="bot-field" /></label>
        </p>
        <div class="row">
          <label>í˜„ì¬ ìƒíƒœ* / TÃ¬nh tráº¡ng hiá»‡n táº¡i
            <select name="status" required>
              <option value="">ì„ íƒ</option>
              <option>Dâ€‘2</option>
              <option>Dâ€‘10</option>
              <option>Eâ€‘7</option>
              <option>ê¸°íƒ€/KhÃ¡c</option>
            </select>
          </label>
          <label>ëª©í‘œ/ê´€ì‹¬* / Má»¥c tiÃªu
            <select name="goal" required>
              <option value="">ì„ íƒ</option>
              <option>Eâ€‘7â€‘4</option>
              <option>Dâ€‘2</option>
              <option>Fâ€‘6</option>
              <option>ì·¨ì—…/Viá»‡c lÃ m</option>
              <option>ê¸°íƒ€/KhÃ¡c</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>ì˜¤ëŠ˜ì˜ 1ìˆœìœ„ / Æ¯u tiÃªn hÃ´m nay*
            <select name="pain" required>
              <option value="">ì„ íƒ</option>
              <option>ì ˆì°¨/Thá»§ tá»¥c</option>
              <option>ì„œë¥˜/Há»“ sÆ¡</option>
              <option>ë¹„ìš©/Chi phÃ­</option>
              <option>ì‚¬ê¸°/Lá»«a Ä‘áº£o</option>
              <option>ê¸°íƒ€/KhÃ¡c</option>
            </select>
          </label>
          <label>ê·¼ë¡œ ê³„íš / Káº¿ hoáº¡ch lÃ m thÃªm
            <select name="work_plan">
              <option value="">ì„ íƒ</option>
              <option>ì—†ìŒ/KhÃ´ng</option>
              <option>í•™ê¸°ì¤‘ í‰ì¼/Trong ká»³</option>
              <option>ì£¼ë§/ë°©í•™/Cuá»‘i tuáº§n/Ká»³ nghá»‰</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>ê¸´ê¸‰ë„ / Má»©c Ä‘á»™ gáº¥p
            <select name="urgency">
              <option value="">ì„ íƒ</option>
              <option>ì¦‰ì‹œ/Ngay</option>
              <option>1ê°œì›”/1 thÃ¡ng</option>
              <option>3ê°œì›”/3 thÃ¡ng</option>
              <option>íƒìƒ‰ ì¤‘/Äang tÃ¬m hiá»ƒu</option>
            </select>
          </label>
          <label>ì—°ë½ ì±„ë„ / KÃªnh liÃªn há»‡
            <select name="contact_channel">
              <option value="">ì„ íƒ</option>
              <option>Email</option>
              <option>Zalo</option>
              <option>Kakao</option>
              <option>ê¸°íƒ€/KhÃ¡c</option>
            </select>
          </label>
        </div>
        <div class="row">
          <label>ì—°ë½ì²˜(ì„ íƒ) / LiÃªn há»‡
            <input type="text" name="contact" placeholder="email@ ë˜ëŠ” Zalo/Kakao ID" />
          </label>
        </div>
        <label>ì˜¤í”ˆì—”ë“œ / CÃ¢u há»i má»Ÿ
          <textarea name="open_question" rows="3" placeholder="ê°€ì¥ í˜¼ë€ìŠ¤ëŸ¬ìš´ ì§ˆë¬¸ 1ê°€ì§€"></textarea>
        </label>
        <!-- Hidden UTM/variant -->
        <input type="hidden" name="utm_source" />
        <input type="hidden" name="utm_medium" />
        <input type="hidden" name="utm_campaign" />
        <input type="hidden" name="utm_content" />
        <input type="hidden" name="variant" />
        <input type="hidden" name="referrer" />
        <input type="hidden" name="ref" />
        <input type="hidden" name="ga_cid" />
        <div style="margin-top:12px"><button type="submit" class="cta">ì œì¶œí•˜ê¸°</button></div>
        <div id="pre-thanks" class="small" style="display:none; margin-top:8px; color:#0a66ff; font-weight:700">ì œì¶œ ì™„ë£Œ! ğŸ‘‰ <a href="#top5">ë‹¹ì‹ ì˜ ì‹¤í–‰ ì¹´ë“œ Top5 ë³´ê¸°</a></div>
      </form>
    </section>

    <!-- ë¦¬ë”ë³´ë“œ (Top20) -->
    <section class="section" id="leaderboard">
      <h3>ë¦¬ë”ë³´ë“œ Top20</h3>
      <div id="lb_wrap" class="card">
        <div class="muted">ì§‘ê³„ ë¡œë”© ì¤‘â€¦</div>
      </div>
    </section>

    <!-- ê·œì¹™ ìš”ì•½ -->
    <section class="section" id="rules">
      <h3>ì´ë²¤íŠ¸ ì•ˆë‚´(ìš”ì•½)</h3>
      <div class="grid">
        <div class="card">ìœ íš¨ ì´ˆëŒ€: ì„¤ê³„ ì œì¶œ + ìµœì†Œ 1í–‰ë™(ì˜¨ë³´ë”©/ì§ˆë¬¸/ë‹µë³€/ë¶ë§ˆí¬/íŒ”ë¡œìš°)</div>
        <div class="card">ì ìˆ˜: ì´ˆëŒ€(ìµœëŒ€40)Â·ì±„íƒ(ìµœëŒ€30)Â·ì¶œì„(ìµœëŒ€15)Â·ì§ˆë¬¸(ìµœëŒ€10)Â·ë¶/íŒ”(ìµœëŒ€5)</div>
        <div class="card">ë³´ìƒ: Top10 ìƒê¸ˆ / ìœ íš¨ ì´ˆëŒ€ 10ëª… ë‹¬ì„± ì¦‰ì‹œ 5ì²œ(ì„ ì°© 200)</div>
      </div>
      <p class="small">ìì„¸í•œ ê·œì¹™ì€ ìš´ì˜ ë¬¸ì„œ ì°¸ì¡°(ops/referral_event_rules_ko_vi.md).</p>
    </section>

    <!-- Netlify Forms: ì˜¨ë³´ë”© ì„¤ë¬¸(5ë¬¸í•­) -->
    <section class="form-section" id="onboarding_survey">
      <h3>ì˜¨ë³´ë”©(5ë¬¸í•­) â€” ì•½ 30ì´ˆ</h3>
      <form name="onboarding_survey" method="POST" data-netlify="true" netlify-honeypot="bot-field" id="form-onb">
        <input type="hidden" name="form-name" value="onboarding_survey" />
        <p style="display:none"><label>Donâ€™t fill this out: <input name="bot-field" /></label></p>
        <div class="row">
          <label>ê°€ì¹˜ ëª…í™•ì„±(1â€“5)
            <select name="value_clarity" required>
              <option value="">ì„ íƒ</option>
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
            </select>
          </label>
          <label>ì‹ ë¢°/ê¶Œìœ„(1â€“5)
            <select name="trust_score" required>
              <option value="">ì„ íƒ</option>
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
            </select>
          </label>
          <label>CTA ëª…í™•ì„±(1â€“5)
            <select name="cta_clarity" required>
              <option value="">ì„ íƒ</option>
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
            </select>
          </label>
        </div>
        <label>ì„ í˜¸ ê¸°ëŠ¥(ë³µìˆ˜)
          <div class="row">
            <label><input type="checkbox" name="features" value="checklist" /> ì²´í¬ë¦¬ìŠ¤íŠ¸</label>
            <label><input type="checkbox" name="features" value="cases" /> ì‚¬ë¡€ ë¼ì´ë¸ŒëŸ¬ë¦¬</label>
            <label><input type="checkbox" name="features" value="curation" /> ì§ˆë¬¸ íë ˆì´ì…˜</label>
            <label><input type="checkbox" name="features" value="webinar" /> ì›¨ë¹„ë‚˜</label>
          </div>
        </label>
        <label>ê°€ì¥ ë¶€ì¡±í–ˆë˜ 1ê°€ì§€
          <textarea name="most_missing" rows="3" placeholder="ë¬´ì—‡ì´ ìˆì—ˆë‹¤ë©´ ë°”ë¡œ ì§„í–‰í•˜ì…¨ë‚˜ìš”?"></textarea>
        </label>
        <!-- Hidden UTM/variant -->
        <input type="hidden" name="utm_source" />
        <input type="hidden" name="utm_medium" />
        <input type="hidden" name="utm_campaign" />
        <input type="hidden" name="utm_content" />
        <input type="hidden" name="variant" />
        <input type="hidden" name="referrer" />
        <input type="hidden" name="ref" />
        <input type="hidden" name="ga_cid" />
        <div style="margin-top:12px"><button type="submit" class="cta">ì œì¶œí•˜ê¸°</button></div>
        <div id="onb-thanks" class="small" style="display:none; margin-top:8px; color:#0a66ff; font-weight:700">ì œì¶œ ì™„ë£Œ! ğŸ‘‰ <a href="#top5">ë‹¹ì‹ ì˜ ì‹¤í–‰ ì¹´ë“œ Top5 ë³´ê¸°</a></div>
      </form>
    </section>

    <script>
      (function() {
        const el = document.getElementById('hero');
        const qp = new URLSearchParams(location.search);
        let variant = qp.get('variant');
        if (!variant) { variant = Math.random() < 0.5 ? 'h1_a' : 'h1_b'; }
        el.dataset.variant = variant;
        const showA = variant === 'h1_a';
        document.querySelector('[data-h1-a]').style.display = showA ? '' : 'none';
        document.querySelector('[data-h1-b]').style.display = showA ? 'none' : '';
        document.querySelector('[data-sub-a]').style.display = showA ? '' : 'none';
        document.querySelector('[data-sub-b]').style.display = showA ? 'none' : '';
        document.querySelector('[data-cta-a]').style.display = showA ? '' : 'none';
        document.querySelector('[data-cta-b]').style.display = showA ? 'none' : '';

        // page_view_custom
        const mkEvent = (name, detail) => new CustomEvent(name, { detail });
        const utm = {}; ['utm_source','utm_medium','utm_campaign','utm_content'].forEach(k=>{ if(qp.get(k)) utm[k]=qp.get(k); });
        const refParam = qp.get('ref') || '';
        window.dispatchEvent(mkEvent('page_view', { url: location.href, referrer: document.referrer, variant, utm }));

        // scroll_75
        let scrolled = false;
        window.addEventListener('scroll', () => {
          const ratio = (window.scrollY)/(document.body.scrollHeight - window.innerHeight + 1);
          if (!scrolled && ratio > 0.75) { scrolled = true; window.dispatchEvent(mkEvent('scroll_75', { url: location.href, variant })); }
        });

        // CTA click â†’ preserve utm + variant
        function appendQuery(base) {
          try { const u = new URL(base);
            Object.entries(utm).forEach(([k,v]) => u.searchParams.set(k, v));
            u.searchParams.set('variant', variant);
            if (refParam) u.searchParams.set('ref', refParam);
            return u.toString();
          } catch { return base; }
        }
        document.getElementById('cta_primary').addEventListener('click', (ev) => {
          window.dispatchEvent(mkEvent('cta_click', { id: 'hero_primary', variant, utm }));
          const base = ev.currentTarget.getAttribute('data-target-a') || '#';
          location.href = appendQuery(base);
        });
        document.getElementById('cta_primary_b').addEventListener('click', (ev) => {
          window.dispatchEvent(mkEvent('cta_click', { id: 'hero_primary', variant, utm }));
          const base = ev.currentTarget.getAttribute('data-target-b') || '#';
          location.href = appendQuery(base);
        });

        // Prefill hidden UTM/variant on Netlify forms
        function getCookie(name){ return ('; '+document.cookie).split('; '+name+'=').pop().split(';')[0]; }
        function parseGaCid(){
          try{
            const g = getCookie('_ga');
            if(!g) return '';
            const parts = g.split('.');
            if(parts.length>=4){ return parts[2]+'.'+parts[3]; }
            return g;
          }catch{ return ''; }
        }
        function refCode(){
          const fromParam = refParam; if(fromParam) return fromParam;
          const stored = localStorage.getItem('ref_code'); if(stored) return stored;
          const cid = parseGaCid().replace(/[^A-Za-z0-9]/g,'').slice(0,16);
          const rnd = Math.random().toString(36).slice(2,10);
          const code = (cid||rnd).slice(0,8);
          localStorage.setItem('ref_code', code);
          return code;
        }
        function fillHidden(form) {
          if (!form) return;
          ['utm_source','utm_medium','utm_campaign','utm_content'].forEach(k=>{
            const el = form.querySelector(`input[name="${k}"]`);
            if (el && qp.get(k)) el.value = qp.get(k);
          });
          const v = form.querySelector('input[name="variant"]'); if (v) v.value = variant;
          const r = form.querySelector('input[name="referrer"]'); if (r) r.value = document.referrer;
          const refEl = form.querySelector('input[name="ref"]'); if (refEl) refEl.value = refCode();
          const cidEl = form.querySelector('input[name="ga_cid"]'); if (cidEl) cidEl.value = parseGaCid();
        }
        fillHidden(document.querySelector('form[name="pre_survey"]'));
        fillHidden(document.querySelector('form[name="onboarding_survey"]'));

        // Track form submit
        function netlifyAjaxSubmit(form, thanksId){
          if(!form) return;
          form.addEventListener('submit', function(ev){
            ev.preventDefault();
            window.dispatchEvent(mkEvent('cta_click', { id: form.name + '_submit', variant, utm }));
            // Build form data
            const data = new FormData(form);
            data.append('form-name', form.getAttribute('name'));
            fetch('/', { method:'POST', body: data }).then(()=>{
              const t = document.getElementById(thanksId); if(t) t.style.display='';
              window.dispatchEvent(mkEvent('sign_up', { id: form.name, variant, utm }));
              // scroll to Top5 after submit
              const top = document.getElementById('top5'); if(top) top.scrollIntoView({behavior:'smooth'});
              form.reset(); fillHidden(form); // keep hidden utm
            }).catch(()=>{
              const t = document.getElementById(thanksId); if(t) t.innerText='ì œì¶œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'; t.style.display='';
            });
          });
        }
        netlifyAjaxSubmit(document.getElementById('form-pre'),'pre-thanks');
        netlifyAjaxSubmit(document.getElementById('form-onb'),'onb-thanks');

        // Build and copy referral link
        const refInput = document.getElementById('ref_link');
        const refBtn = document.getElementById('ref_copy');
        if(refInput && refBtn){
          const base = location.origin + location.pathname;
          const code = refCode();
          const url = new URL(base);
          url.searchParams.set('ref', code);
          // keep utm if present in current URL for share consistency
          Object.entries(utm).forEach(([k,v])=>{ if(v) url.searchParams.set(k,v); });
          url.searchParams.set('variant', el.dataset.variant || 'h1_a');
          refInput.value = url.toString();
          refBtn.addEventListener('click', async ()=>{
            try{ await navigator.clipboard.writeText(refInput.value); window.dispatchEvent(mkEvent('cta_click',{id:'ref_copy',variant,utm})); refBtn.textContent='ë³µì‚¬ë¨'; setTimeout(()=>refBtn.textContent='ë³µì‚¬',1500);}catch{}
          });
        }

        // Leaderboard loader
        const lbWrap = document.getElementById('lb_wrap');
        async function fetchText(u){ const r = await fetch(u, {cache:'no-store'}); if(!r.ok) throw new Error('load fail'); return await r.text(); }
        function parseCSV(t){ const [h,...rows]=t.trim().split(/\r?\n/).map(l=>l.split(',')); return rows.map(c=>Object.fromEntries(c.map((v,i)=>[h[i],v]))); }
        function renderLB(items){ if(!lbWrap) return; if(!items||!items.length){ lbWrap.innerHTML='<div class="muted">ì§‘ê³„ ë°ì´í„°ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
          const head = '<table class="lb"><thead><tr><th>ìˆœìœ„</th><th>ì°¸ê°€ì</th><th>ì´ì </th><th>ì´ˆëŒ€</th><th>ì±„íƒ</th><th>í™œë™ì¼</th></tr></thead><tbody>';
          const body = items.slice(0,20).map((it,idx)=>`<tr><td>${idx+1}</td><td>${it.user||it.nickname||'-'}</td><td>${it.score||it.total||0}</td><td>${it.invites||it.valid_invites||0}</td><td>${it.accepted||it.accepts||0}</td><td>${it.days||it.active_days||0}</td></tr>`).join('');
          lbWrap.innerHTML = head+body+'</tbody></table>';
        }
        (async ()=>{
          try{
            const meta = document.querySelector('meta[name="leaderboard-url"]');
            const url = (meta && meta.getAttribute('content')) || '/leaderboard.json';
            const txt = await fetchText(url);
            let items;
            if(url.endsWith('.csv')){ items = parseCSV(txt); }
            else { items = JSON.parse(txt); }
            renderLB(items);
          }catch(e){ if(lbWrap) lbWrap.innerHTML='<div class="muted">ë¦¬ë”ë³´ë“œ ì—°ê²° ëŒ€ê¸° ì¤‘(ê´€ë¦¬ì ì„¤ì • í•„ìš”)</div>'; }
        })();
      })();
    </script>

    <!-- Sticky CTA -->
    <button class="cta sticky-cta" onclick="location.hash='#pre_survey'">ì§€ê¸ˆ ë‚´ ì‹¤í–‰ ì¹´ë“œ ë³´ê¸°</button>

  </body>
  </html>
